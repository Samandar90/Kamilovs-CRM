<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kamilovs Clinic CRM</title>
    <link rel="stylesheet" href="css/style.css" />
</head>

<body>
    <!-- ===== LOGIN SCREEN ===== -->
    <section class="login-screen" id="loginScreen">
        <div class="login-card">
            <h1 class="login-title">Kamilovs Clinic CRM</h1>
            <p class="login-subtitle">
                Вход в систему управления записями, пациентами и отчётами
            </p>

            <div class="field">
                <span>Логин</span>
                <input id="loginUsername" type="text" placeholder="" />
            </div>

            <div class="field">
                <span>Пароль</span>
                <input id="loginPassword" type="password" placeholder="" />
            </div>

            <button class="btn btn-primary" id="loginBtn" type="button">
                Войти
            </button>

            <div class="login-error" id="loginError"></div>
           
        </div>
    </section>

    <!-- ===== MAIN APP ===== -->
    <section class="app-layout hidden" id="mainScreen">
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>Kamilovs CRM</h2>
                <p class="sidebar-subtitle">Clinic OS</p>
            </div>

            <nav class="sidebar-nav">
                <button class="nav-btn active" data-view="dashboard" type="button">
                    Дашборд
                </button>
                <button class="nav-btn" data-view="appointments" type="button">
                    Записи
                </button>
                <button class="nav-btn" data-view="doctors" type="button">
                    Врачи
                </button>
                <button class="nav-btn" data-view="services" type="button">
                    Услуги
                </button>
                <button class="nav-btn" data-view="patients" type="button">
                    Пациенты
                </button>
                <button class="nav-btn" data-view="reports" type="button">
                    Отчёты
                </button>
            </nav>

            <div class="sidebar-footer">
                <button class="btn btn-ghost" id="logoutBtn" type="button">
                    Выйти
                </button>
            </div>
        </aside>

        <!-- MAIN -->
        <main class="main">
            <header class="main-header">
                <div>
                    <h1 id="pageTitle">Дашборд</h1>
                    <p id="pageSubtitle">
                        Краткая сводка по клинике и быстрый доступ к основным действиям
                    </p>
                </div>

                <div class="main-header-right">
                    <div class="today-label">
                        Сегодня: <span id="todayDate">—</span>
                    </div>
                </div>
            </header>

            <!-- ===== VIEW: DASHBOARD ===== -->
            <section class="view view--active" id="view-dashboard">
                <!-- KPI -->
                <div class="card kpi-card-container">
                    <div class="card-header">
                        <h2>Ключевые показатели</h2>
                        <div class="card-header-controls">
                            <div class="field field-inline field-inline-wide">
                                <span>Фильтр врача</span>
                                <select id="dashDoctorFilter" class="doctor-filter"></select>
                            </div>
                        </div>
                    </div>

                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <p class="kpi-card__label">Записей сегодня</p>
                            <p class="kpi-card__value" id="kpiTodayTotal">0</p>
                            <p class="kpi-card__hint">Все статусы</p>
                        </div>

                        <div class="kpi-card">
                            <p class="kpi-card__label">Завершено сегодня</p>
                            <p class="kpi-card__value" id="kpiTodayDone">0</p>
                            <p class="kpi-card__hint">Статус “Пришёл”</p>
                        </div>

                        <div class="kpi-card">
                            <p class="kpi-card__label">Выручка сегодня</p>
                            <p class="kpi-card__value" id="kpiTodayRevenue">0 UZS</p>
                            <p class="kpi-card__hint">Done + (Paid/Partial)</p>
                        </div>

                    </div>
                </div>

                <!-- Today table -->
                <div class="card">
                    <div class="card-header">
                        <h2>Сегодняшние записи</h2>
                        <p class="table-hint">
                            Статусы “Визит/Оплата” кликабельны — меняются по кругу
                        </p>
                    </div>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Время</th>
                                    <th>Врач</th>
                                    <th>Пациент</th>
                                    <th>Телефон</th>
                                    <th>Услуга</th>
                                    <th>Сумма</th>
                                    <th>Визит</th>
                                    <th>Оплата</th>
                                </tr>
                            </thead>
                            <tbody id="dashboardTodayBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- PRO: Timeline + Load -->
                

                <div class="card">
                    <div class="card-header">
                        <h2>Загрузка врачей по выбранному диапазону</h2>
                        <p class="table-hint">
                            Берётся из фильтров раздела “Записи” (диапазон/врач/поиск)
                        </p>
                    </div>
                    <div id="dashDoctorLoadBody"></div>
                </div>
            </section>

            <!-- ===== VIEW: APPOINTMENTS ===== -->
            <section class="view" id="view-appointments">
                <div class="card">
                    <h2>Новая запись</h2>

                    <form id="appointmentForm">
                        <div class="form-grid">
                            <div class="field">
                                <span>Дата *</span>
                                <input id="apptDate" type="date" required />
                            </div>

                            <div class="field">
                                <span>Время *</span>
                                <input id="apptTime" type="time" required />
                            </div>

                            <div class="field">
                                <span>Врач *</span>
                                <select id="apptDoctor" required></select>
                            </div>

                            <div class="field">
                                <span>Пациент *</span>
                                <input id="apptPatient" type="text" placeholder="ФИО" required />
                            </div>

                            <div class="field">
                                <span>Телефон</span>
                                <input id="apptPhone" type="text" placeholder="+998..." />
                            </div>

                            <div class="field">
                                <span>Услуга *</span>
                                <select id="apptService" required></select>
                            </div>

                            <div class="field">
                                <span>Цена (UZS)</span>
                                <input id="apptPrice" type="number" min="0" />
                            </div>

                            <div class="field">
                                <span>Статус визита</span>
                                <select id="apptStatusVisit">
                                    <option value="scheduled">Запланирован</option>
                                    <option value="done">Пришёл</option>
                                    <option value="no_show">Не пришёл</option>
                                </select>
                            </div>

                            <div class="field">
                                <span>Статус оплаты</span>
                                <select id="apptStatusPayment">
                                    <option value="unpaid">Не оплачено</option>
                                    <option value="partial">Частично</option>
                                    <option value="paid">Оплачено</option>
                                </select>
                            </div>

                            <div class="field">
                                <span>Метод оплаты</span>
                                <select id="apptPaymentMethod">
                                    <option value="none">—</option>
                                    <option value="cash">Наличные</option>
                                    <option value="card">Карта</option>
                                    <option value="online">Онлайн</option>
                                </select>
                            </div>

                            <div class="field field-full">
                                <button class="btn btn-primary" type="submit">
                                    Добавить запись
                                </button>
                            </div>
                        </div>
                    </form>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2>Все записи</h2>

                        <div class="card-header-controls">
                            <div class="field field-inline">
                                <span>С</span>
                                <input id="rangeFrom" type="date" class="date-filter" />
                            </div>

                            <div class="field field-inline">
                                <span>По</span>
                                <input id="rangeTo" type="date" class="date-filter" />
                            </div>

                            <div class="field field-inline field-inline-wide">
                                <span>Врач</span>
                                <select id="rangeDoctor" class="doctor-filter"></select>
                            </div>

                            <div class="field field-inline field-inline-wide">
                                <span>Поиск</span>
                                <input id="rangeSearch" type="text" class="search-input" placeholder="ФИО / телефон" />
                            </div>

                            <button class="btn btn-ghost btn-compact" id="exportRangeCsv" type="button">
                                Экспорт CSV
                            </button>
                        </div>
                    </div>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Дата</th>
                                    <th>Время</th>
                                    <th>Врач</th>
                                    <th>Пациент</th>
                                    <th>Телефон</th>
                                    <th>Услуга</th>
                                    <th>Сумма</th>
                                    <th>Визит</th>
                                    <th>Оплата</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody id="allAppointmentsBody"></tbody>
                        </table>
                    </div>

                    <p class="table-hint">
                        Совет: держи “Записи” открытыми — а “Загрузка врачей” на дашборде
                        автоматически обновляется от этих фильтров.
                    </p>
                </div>
            </section>

            <!-- ===== VIEW: DOCTORS ===== -->
            <section class="view" id="view-doctors">
                <div class="card">
                    <div class="card-header">
                        <h2>Врачи</h2>
                        <button class="btn btn-primary btn-compact" id="addDoctorBtn" type="button">
                            + Добавить врача
                        </button>
                    </div>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Имя</th>
                                    <th>Специальность</th>
                                    <th>%</th>
                                    <th>Активен</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody id="doctorsTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- ===== VIEW: SERVICES ===== -->
            <section class="view" id="view-services">
                <div class="card">
                    <div class="card-header">
                        <h2>Услуги</h2>
                        <button class="btn btn-primary btn-compact" id="addServiceBtn" type="button">
                            + Добавить услугу
                        </button>
                    </div>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Название</th>
                                    <th>Категория</th>
                                    <th>Цена</th>
                                    <th>Активна</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody id="servicesTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- ===== VIEW: PATIENTS ===== -->
            <section class="view" id="view-patients">
                <div class="card">
                    <div class="card-header">
                        <h2>Пациенты</h2>

                        <div class="card-header-controls">
                            <div class="field field-inline field-inline-wide">
                                <span>Режим</span>
                                <select id="patientsArchiveMode" class="doctor-filter">
                                    <option value="active">Активные</option>
                                    <option value="all">Все</option>
                                    <option value="archived">Архив</option>
                                </select>
                            </div>

                            <div class="field field-inline field-inline-wide">
                                <span>Поиск</span>
                                <input id="patientsSearch" type="text" class="search-input"
                                    placeholder="ФИО / телефон" />
                            </div>
                        </div>
                    </div>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Пациент</th>
                                    <th>Телефон</th>
                                    <th>Визитов (done)</th>
                                    <th>Выручка</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody id="patientsTableBody"></tbody>
                        </table>
                    </div>

                    <p class="table-hint">
                        Risk показывает вероятность no-show/неоплат. Архив скрывает пациента,
                        “Удалить навсегда” удаляет все его записи.
                    </p>
                </div>
            </section>

            <!-- ===== VIEW: REPORTS ===== -->
            <section class="view" id="view-reports">
                <div class="card">
                    <h2>Отчёт за день</h2>
                    <div class="field field-inline field-inline-wide">
                        <span>Дата</span>
                        <input id="reportDate" type="date" class="date-filter" />
                    </div>

                    <div class="summary">
                        <h3>По врачам</h3>
                        <ul id="reportDoctorTotals"></ul>
                        <h3>Итого клиника</h3>
                        <div id="reportClinicTotal">0 UZS</div>
                    </div>
                </div>

                <div class="card">
                    <h2>Отчёт за месяц / год</h2>

                    <div class="form-grid">
                        <div class="field">
                            <span>Месяц (YYYY-MM)</span>
                            <input id="reportMonth" type="month" />
                        </div>

                        <div class="field">
                            <span>Год</span>
                            <input id="reportYear" type="number" min="2000" max="2100" />
                        </div>
                    </div>

                    <div class="summary">
                        <h3>Месяц — по врачам</h3>
                        <ul id="reportMonthDoctorTotals"></ul>
                        <h3>Месяц — итого клиника</h3>
                        <div id="reportMonthClinicTotal">0 UZS</div>

                        <h3 style="margin-top: 14px">Год — по врачам</h3>
                        <ul id="reportYearDoctorTotals"></ul>
                        <h3>Год — итого клиника</h3>
                        <div id="reportYearClinicTotal">0 UZS</div>
                    </div>
                </div>
            </section>
        </main>
    </section>

    <!-- ===== MODALS ===== -->

    <!-- Edit Appointment Modal -->
    <div class="modal-backdrop hidden" id="editApptModalBackdrop">
        <div class="modal" role="dialog" aria-modal="true">
            <h2>Редактирование записи</h2>

            <form id="editApptForm">
                <div class="form-grid">
                    <div class="field">
                        <span>Дата *</span>
                        <input id="editApptDate" type="date" required />
                    </div>

                    <div class="field">
                        <span>Время *</span>
                        <input id="editApptTime" type="time" required />
                    </div>

                    <div class="field">
                        <span>Врач *</span>
                        <select id="editApptDoctor" required></select>
                    </div>

                    <div class="field">
                        <span>Пациент *</span>
                        <input id="editApptPatient" type="text" required />
                    </div>

                    <div class="field">
                        <span>Телефон</span>
                        <input id="editApptPhone" type="text" />
                    </div>

                    <div class="field">
                        <span>Услуга *</span>
                        <select id="editApptService" required></select>
                    </div>

                    <div class="field">
                        <span>Цена (UZS)</span>
                        <input id="editApptPrice" type="number" min="0" />
                    </div>

                    <div class="field">
                        <span>Статус визита</span>
                        <select id="editApptStatusVisit">
                            <option value="scheduled">Запланирован</option>
                            <option value="done">Пришёл</option>
                            <option value="no_show">Не пришёл</option>
                        </select>
                    </div>

                    <div class="field">
                        <span>Статус оплаты</span>
                        <select id="editApptStatusPayment">
                            <option value="unpaid">Не оплачено</option>
                            <option value="partial">Частично</option>
                            <option value="paid">Оплачено</option>
                        </select>
                    </div>

                    <div class="field">
                        <span>Метод оплаты</span>
                        <select id="editApptPaymentMethod">
                            <option value="none">—</option>
                            <option value="cash">Наличные</option>
                            <option value="card">Карта</option>
                            <option value="online">Онлайн</option>
                        </select>
                    </div>
                </div>

                <div class="modal-actions" style="margin-top: 12px">
                    <button class="btn btn-ghost" type="button" id="editApptCancelBtn">
                        Отмена
                    </button>
                    <button class="btn btn-primary" type="submit">Сохранить</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Doctor Modal -->
    <div class="modal-backdrop hidden" id="doctorModalBackdrop">
        <div class="modal" role="dialog" aria-modal="true">
            <h2 id="doctorModalTitle">Новый врач</h2>

            <form id="doctorForm">
                <div class="form-grid">
                    <div class="field field-full">
                        <span>Имя *</span>
                        <input id="doctorName" type="text" required />
                    </div>

                    <div class="field field-full">
                        <span>Специальность</span>
                        <input id="doctorSpeciality" type="text" />
                    </div>

                    <div class="field">
                        <span>% врача</span>
                        <input id="doctorPercent" type="number" min="0" max="100" />
                    </div>

                    <div class="field">
                        <span>Активен</span>
                        <select id="doctorActive">
                            <option value="true">Да</option>
                            <option value="false">Нет</option>
                        </select>
                    </div>
                </div>

                <div class="modal-actions" style="margin-top: 12px">
                    <button class="btn btn-ghost" type="button" id="doctorCancelBtn">
                        Отмена
                    </button>
                    <button class="btn btn-primary" type="submit">Сохранить</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Service Modal -->
    <div class="modal-backdrop hidden" id="serviceModalBackdrop">
        <div class="modal" role="dialog" aria-modal="true">
            <h2 id="serviceModalTitle">Новая услуга</h2>

            <form id="serviceForm">
                <div class="form-grid">
                    <div class="field field-full">
                        <span>Название *</span>
                        <input id="serviceName" type="text" required />
                    </div>

                    <div class="field field-full">
                        <span>Категория</span>
                        <input id="serviceCategory" type="text" />
                    </div>

                    <div class="field">
                        <span>Цена (UZS)</span>
                        <input id="servicePrice" type="number" min="0" />
                    </div>

                    <div class="field">
                        <span>Активна</span>
                        <select id="serviceActive">
                            <option value="true">Да</option>
                            <option value="false">Нет</option>
                        </select>
                    </div>
                </div>

                <div class="modal-actions" style="margin-top: 12px">
                    <button class="btn btn-ghost" type="button" id="serviceCancelBtn">
                        Отмена
                    </button>
                    <button class="btn btn-primary" type="submit">Сохранить</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Patient Modal -->
    <div class="modal-backdrop hidden" id="patientModalBackdrop">
        <div class="modal" role="dialog" aria-modal="true">
            <div class="card-header" style="margin-bottom: 8px">
                <h2 id="patientModalTitle">История пациента</h2>
                <button class="btn btn-ghost btn-compact" type="button" id="patientModalClose">
                    Закрыть
                </button>
            </div>

            <div class="patient-history" id="patientHistoryBody"></div>
        </div>
    </div>

    <!-- Toasts -->
    <div class="toast-container" id="toastContainer"></div>

    <script defer src="/docs/js/app.js"></script>
</body>

</html>